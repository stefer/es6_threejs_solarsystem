<!DOCTYPE html>
<html>
<head>
    <title>Sun</title>
    <style>
        h1 {text-align: center;}
        canvas {
                width: 100%;
                height: 100%;
                display: block;
        }
        .label {
				color: #FFF;
				font-family: sans-serif;
				padding: 2px;
				background: rgba( 0, 0, 0, .6 );
			}
    </style>
</head>
<body>
    <canvas id = 'canvas'></canvas>
</body>

<script type="module">

    
    import * as THREE from "./js/three.module.js";
    import { OrbitControls } from "./js/OrbitControls.js";
    import { Planets, Sun, Au } from "./js/SolarSystem.js";
    import { BodyBuilder } from "./js/three.planets.js";
    import { CSS2DRenderer } from "./js/CSS2DRenderer.js";

    THREE.Object3D.DefaultUp = new THREE.Vector3(0,0,1); // OpenGL has y up - and I thought it was z up, fix this correctly later

    const Scale = 1.0/Sun.radius;

    const canvas = document.querySelector('#canvas');
	var renderer = new THREE.WebGLRenderer({canvas});
    renderer.setSize( canvas.clientWidth, canvas.clientHeight );
    renderer.antialias = true;

    const labelRenderer = new CSS2DRenderer();
    labelRenderer.setSize( canvas.clientWidth, canvas.clientHeight );
    labelRenderer.domElement.style.position = 'absolute';
    labelRenderer.domElement.style.top = '0';
    labelRenderer.domElement.style.pointerEvents = 'none';
    document.body.appendChild( labelRenderer.domElement );

    var onRenderFcts= [];
    var builder = new BodyBuilder(Scale, {scaleSun: 1.0, scalePlanets: 1.0, scaleOrbits: 1 });
	var sunScene	= new THREE.Scene(); // Use a separate scene for sun and ambient light to make it shine
	var scene	= new THREE.Scene();
    var camera	= new THREE.PerspectiveCamera(45, canvas.clientWidth / canvas.clientHeight, 0.01, 1000 );
    camera.position.set(-100, -50, 50);

    var controls = new OrbitControls( camera, renderer.domElement );
    //controls.addEventListener( 'change', render ); // call this only in static scenes (i.e., if there is no animation loop)
    controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
    controls.dampingFactor = 0.05;
    controls.screenSpacePanning = true;
    controls.minDistance = 0.001;
    controls.maxDistance = 5000;
    controls.minPolarAngle = -Math.PI;
    controls.maxPolarAngle = Math.PI*2;

    // A bright ambient light for the sun
	var light	= new THREE.AmbientLight( 0x888888, 3 )
	sunScene.add(light)

    // A point light at the center of the sun
    var pointLight = new THREE.PointLight( 0xffffff, 1, 500, 1);
    pointLight.position.set( 0, 0, 0 );
    scene.add( pointLight );
    var pointLightHelper = new THREE.PointLightHelper( pointLight, Sun.radius * Scale );
    scene.add( pointLightHelper );

    // A dim ambient light for all planets
	var light = new THREE.AmbientLight( 0x888888, 0.2 )
	scene.add(light)

	scene.add( new THREE.AxesHelper( 20 ) );

    sunScene.add(builder.buildSun());

    builder.buildPlanets().forEach(planet => {scene.add(planet.container);});

    onRenderFcts.push(function(deltasec, nowsec){
        controls.update();
		renderer.autoClear = false;
        renderer.clear();
        renderer.render( sunScene, camera );
        renderer.render( scene, camera );
        labelRenderer.render( scene, camera );
        labelRenderer.render( sunScene, camera );
    })
    
    var lastTimeMsec= null
	requestAnimationFrame(function animate(nowMsec){
		// keep looping
		requestAnimationFrame( animate );
		// measure time
		lastTimeMsec	= lastTimeMsec || nowMsec-1000/60
		var deltaMsec	= Math.min(200, nowMsec - lastTimeMsec)
		lastTimeMsec	= nowMsec
		// call each update function
		onRenderFcts.forEach(function(onRenderFct){
			onRenderFct(deltaMsec/1000, nowMsec/1000)
		})
    })
    
    // Debug for Three.js inspector
    window.scene = scene;
    window.THREE = THREE

</script>

</html>