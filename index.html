<!DOCTYPE html>
<html>
<head>
    <title>Sun</title>
    <style>
        h1 {text-align: center;}
        canvas {
                width: 100%;
                height: 100%;
                display: block;
        }
    </style>
</head>
<body>
    <canvas id = 'canvas'></canvas>
</body>

<script type="module">

    
    import * as THREE from "./js/three.module.js";
    import { MapControls } from "./js/OrbitControls.js";
    import { Planets, Sun, Au } from "./js/SolarSystem.js";
    import { BodyBuilder } from "./js/three.planets.js";

    const Scale = 1.0/Au;

    const canvas = document.querySelector('#canvas');
	var renderer = new THREE.WebGLRenderer({canvas});
    renderer.setSize( canvas.clientWidth, canvas.clientHeight );
    renderer.antialias = true;

    var onRenderFcts= [];
    var builder = new BodyBuilder(Scale, {scaleSun: 1.0, scalePlanets: 100.0, scaleOrbits: 1 });
	var sunScene	= new THREE.Scene(); // Use a separate scene for sun and ambient light to make it shine
	var scene	= new THREE.Scene();
	var camera	= new THREE.PerspectiveCamera(45, canvas.clientWidth / canvas.clientHeight, 0.01, 1000 );
	camera.position.z = 3;

    var controls = new MapControls( camera, renderer.domElement );
    //controls.addEventListener( 'change', render ); // call this only in static scenes (i.e., if there is no animation loop)
    controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
    controls.dampingFactor = 0.05;
    controls.screenSpacePanning = false;
    controls.minDistance = 0.01;
    controls.maxDistance = 5000;
    controls.maxPolarAngle = Math.PI / 2;

    // A bright ambient light for the sun
	var light	= new THREE.AmbientLight( 0x888888, 3 )
	sunScene.add(light)

    // A point light at the center of the sun
    var pointLight = new THREE.PointLight( 0xffffff, 1, 500, 1);
    pointLight.position.set( 0, 0, 0 );
    scene.add( pointLight );
    var pointLightHelper = new THREE.PointLightHelper( pointLight, Sun.radius * Scale );
    scene.add( pointLightHelper );

    // A dim ambient light for all planets
	var light = new THREE.AmbientLight( 0x888888, 0.2 )
	scene.add(light)

    sunScene.add(builder.buildSun());

    builder.buildPlanets().forEach(element => {scene.add(element);});

    onRenderFcts.push(function(){
		renderer.autoClear = false;
        renderer.clear();
        renderer.render( sunScene, camera );
        renderer.render( scene, camera );	
	})

    var lastTimeMsec= null
	requestAnimationFrame(function animate(nowMsec){
		// keep looping
		requestAnimationFrame( animate );
		// measure time
		lastTimeMsec	= lastTimeMsec || nowMsec-1000/60
		var deltaMsec	= Math.min(200, nowMsec - lastTimeMsec)
		lastTimeMsec	= nowMsec
		// call each update function
		onRenderFcts.forEach(function(onRenderFct){
			onRenderFct(deltaMsec/1000, nowMsec/1000)
		})
    })
    
</script>

</html>